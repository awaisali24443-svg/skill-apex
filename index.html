<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Skill Apex | AI Learning Mastery</title>

    <meta name="description" content="Skill Apex is an AI-powered learning platform. Generate personalized courses, quizzes, and skill trees instantly.">

    <link rel="icon" href="assets/icons/favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="manifest.json">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@600;700;800&family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- External Libs -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

    <!-- Theme & Global Styles -->
    <link id="theme-stylesheet" rel="stylesheet" href="themes/theme-light-cyber.css">
    <link rel="stylesheet" href="global/global.css">

    <!-- FIXED IMPORT MAP -->
    <script async src="https://ga.jspm.io/npm:es-module-shims@1.10.0/dist/es-module-shims.js"></script>

    <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js",
        "firebase/analytics": "https://www.gstatic.com/firebasejs/10.13.1/firebase-analytics.js",

        "dompurify": "https://esm.sh/dompurify@3.1.6",
        "@google/genai": "https://esm.sh/@google/generative-ai@0.15.0"
      }
    }
    </script>

    <!-- ERROR & SPLASH CSS -->
    <style>
        :root { --boot-bg:#020617; --boot-accent:#0ea5e9; --boot-danger:#ef4444; }
        body { background:var(--boot-bg); margin:0; overflow:hidden; height:100vh; width:100vw; }

        #splash-screen {
            position:fixed; inset:0; z-index:10000;
            background:var(--boot-bg); display:flex;
            flex-direction:column; align-items:center; justify-content:center;
            transition:opacity .5s ease-out;
        }
        #splash-screen.hidden { opacity:0; pointer-events:none; }
        .splash-logo { width:96px; height:96px; margin-bottom:48px; filter:drop-shadow(0 0 30px rgba(14,165,233,.5)); animation:pulse-logo 3s infinite; }
        .loader-container { width:240px; height:4px; background:rgba(255,255,255,.05); border-radius:2px; overflow:hidden; }
        .loader-bar { height:100%; width:40%; background:var(--boot-accent); animation:load-scan 1.4s infinite; }

        @keyframes load-scan { 0% { transform:translateX(-100%); } 100% { transform:translateX(200%); } }
        @keyframes pulse-logo { 0%,100% { transform:scale(1) } 50% { transform:scale(.95); opacity:.8 } }

        #fatal-error-overlay {
            display:none; position:fixed; inset:0; z-index:10001;
            background:#020617; color:#fff; padding:40px; text-align:center;
            display:flex; flex-direction:column; align-items:center; justify-content:center;
        }
        .error-content { max-width:500px; background:rgba(15,23,42,0.6); border:1px solid rgba(239,68,68,.3); border-radius:16px; padding:32px; }
        pre { background:#000; padding:16px; border-radius:8px; color:#fca5a5; font-size:11px; border-left:2px solid var(--boot-danger); }
        .btn-retry { padding:12px 32px; background:var(--boot-accent); color:#fff; border:none; border-radius:8px; font-weight:700; }
    </style>

    <!-- GLOBAL ERROR HANDLER -->
    <script>
        window.APP_STATUS = { booted: false };

        window.showFatalError = function(title, details) {
            document.getElementById("splash-screen").style.display = "none";
            const overlay = document.getElementById("fatal-error-overlay");
            overlay.style.display = "flex";
            document.getElementById("error-title").textContent = title || "Critical Error";
            document.getElementById("error-debug").textContent = details || "Unknown error";
        };

        window.addEventListener("error", e => {
            if (!window.APP_STATUS.booted) {
                window.showFatalError("System Error", e.error?.message || e.message);
            }
        });

        window.addEventListener("unhandledrejection", e => {
            if (!window.APP_STATUS.booted) {
                window.showFatalError("Async Error", e.reason?.message || String(e.reason));
            }
        });
    </script>

</head>

<body>

<div id="global-background"></div>
<div id="auth-container" style="display:none;"></div>

<!-- SPLASH SCREEN -->
<div id="splash-screen">
    <img src="assets/icons/favicon.svg" class="splash-logo">
    <div class="loader-container"><div class="loader-bar"></div></div>
    <p class="splash-text">System Initializing...</p>
</div>

<!-- ERROR OVERLAY -->
<div id="fatal-error-overlay">
    <div class="error-content">
        <h3 id="error-title">System Failure</h3>
        <pre id="error-debug"></pre>
        <button onclick="location.reload()" class="btn-retry">Reload</button>
    </div>
</div>

<!-- APP WRAPPER -->
<div id="app-wrapper" style="display:none;">
    <nav id="sidebar"></nav>
    <main id="app-container"><div id="app"></div></main>
</div>

<!-- UI Elements -->
<div id="modal-container"></div>
<div id="toast-container"></div>

<!-- MAIN SCRIPTS -->
<script src="global/global.js"></script>
<script type="module" src="index.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    if (window.mermaid) mermaid.initialize({ startOnLoad: false, theme: "base", securityLevel: "loose" });
});
</script>

</body>
</html>
