
:root {
    --sidebar-width-collapsed: 70px;
    --sidebar-width-desktop: 260px; /* Slightly reduced for better proportion */
    --header-height: 70px;
    --border-radius: 16px;
    --transition-speed: 0.3s;
    --transition-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
    --font-family-body: 'Inter', sans-serif;
    --font-family-heading: 'Exo 2', sans-serif;
    --font-family-mono: 'Roboto Mono', monospace;
    --color-primary-rgb: 37, 99, 235;

    /* Missing Spacing Scale */
    --space-xs: 0.25rem;
    --space-sm: 0.5rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2.5rem;
    --space-xxl: 4rem;
}

body {
    margin: 0; padding: 0;
    font-family: var(--font-family-body);
    background-color: var(--color-background);
    color: var(--color-text);
    overflow: hidden;
    height: 100vh;
}

/* --- PERFORMANCE MODE OVERRIDES --- */
body.low-perf * {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow: none !important;
}

body.low-perf .neural-link-bar,
body.low-perf .card,
body.low-perf .state-content,
body.low-perf .new-quiz-footer {
    background: var(--color-surface) !important;
    border: 1px solid var(--color-border);
}

/* --- LAYOUT STRUCTURE (Vertical Sidebar) --- */
#app-wrapper {
    margin-top: 30px; /* Space for neural link bar */
    display: flex;
    flex-direction: row; /* Always row, never column-reverse */
    height: calc(100vh - 30px);
    width: 100vw;
}

#sidebar {
    width: var(--sidebar-width-desktop);
    background: var(--glass-surface);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-right: 1px solid var(--glass-border);
    display: flex;
    flex-direction: column;
    z-index: 100;
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease;
    flex-shrink: 0; /* Prevent shrinking */
}

#app-container {
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: hidden; /* Prevent horizontal scroll */
    position: relative;
    padding: 0;
    width: 100%; /* Ensure it fills remaining space */
}

#app-container.full-bleed-container {
    overflow: hidden;
}

/* Sidebar Internals */
.sidebar-inner {
    display: flex; flex-direction: column; height: 100%;
    padding: 1rem;
    overflow: hidden; /* Ensure content doesn't bleed during transition */
}

.sidebar-profile-header {
    display: flex; align-items: center; gap: 12px;
    padding: 12px; margin-bottom: 20px;
    background: var(--color-surface-hover);
    border-radius: 12px; border: 1px solid var(--color-border);
    overflow: hidden; /* Hide overflow for collapsed state */
    white-space: nowrap;
}

.profile-avatar-container { width: 40px; height: 40px; border-radius: 50%; overflow: hidden; flex-shrink: 0; }
.profile-avatar-img { width: 100%; height: 100%; object-fit: cover; }
.profile-info-text { display: flex; flex-direction: column; overflow: hidden; white-space: nowrap; transition: opacity 0.2s; }
.profile-name { font-weight: 700; font-size: 0.9rem; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
.profile-role { font-size: 0.7rem; color: var(--color-primary); letter-spacing: 1px; text-transform: uppercase; }

.sidebar-divider { height: 1px; background: var(--color-border); margin: 0 10px 20px 10px; }
.sidebar-menu-label { font-size: 0.7rem; color: var(--color-text-secondary); margin: 0 0 10px 12px; font-weight: 700; letter-spacing: 1px; white-space: nowrap; transition: opacity 0.2s; }

.sidebar-links {
    display: flex; flex-direction: column; gap: 4px; flex-grow: 1;
    overflow-y: auto; overflow-x: hidden;
}

.sidebar-link {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 16px; border-radius: 12px;
    color: var(--color-text-secondary);
    text-decoration: none; transition: all 0.2s;
    font-weight: 500;
    white-space: nowrap; /* Prevent text wrap in transition */
}

.sidebar-link:hover { background: var(--color-surface-hover); color: var(--color-text); }
.sidebar-link.active { background: var(--color-surface-active); color: var(--color-primary); font-weight: 700; border: 1px solid var(--color-border); }
.sidebar-link .icon { width: 20px; height: 20px; flex-shrink: 0; }
.sidebar-link .text { transition: opacity 0.2s; }

.sidebar-footer { margin-top: auto; padding-top: 20px; display: flex; flex-direction: column; gap: 4px; border-top: 1px solid var(--color-border); }

/* --- MOBILE & TABLET LAYOUT (EXPANDABLE RAIL) --- */
@media (max-width: 900px) {
    /* Layout Switch: Use Fixed/Absolute positioning for Sidebar on mobile */
    #app-wrapper {
        display: block; /* Disable flex to manage absolute positioning manually */
    }

    #sidebar {
        position: fixed;
        top: 30px; /* Below neural link bar */
        left: 0;
        bottom: 0;
        width: var(--sidebar-width-collapsed);
        z-index: 500;
    }

    #app-container {
        margin-left: var(--sidebar-width-collapsed);
        width: calc(100vw - var(--sidebar-width-collapsed));
        height: 100%;
    }

    /* Collapsed State Styles */
    .sidebar-inner { padding: 0.8rem 0.5rem; }
    .sidebar-profile-header { padding: 8px; justify-content: center; background: transparent; border: none; }
    .sidebar-divider { margin: 0 5px 20px 5px; }
    .sidebar-link { justify-content: center; padding: 12px 0; }
    .sidebar-link .link-icon-wrapper { margin: 0; }
    .sidebar-footer { align-items: center; }

    /* Hide Text Labels Initially */
    .profile-info-text,
    .sidebar-menu-label,
    .sidebar-link .text {
        opacity: 0;
        pointer-events: none;
        display: none; /* Fully hide to prevent layout interference */
    }

    /* EXPANDED STATE (Triggered via JS) */
    #sidebar.expanded {
        width: var(--sidebar-width-desktop);
        box-shadow: 10px 0 40px rgba(0,0,0,0.5); /* Deep shadow to separate from content */
    }

    /* Restore Styles when Expanded */
    #sidebar.expanded .sidebar-inner { padding: 1rem; }
    
    #sidebar.expanded .profile-info-text,
    #sidebar.expanded .sidebar-menu-label,
    #sidebar.expanded .sidebar-link .text {
        display: block;
        opacity: 1;
        pointer-events: auto;
        animation: fadeInText 0.3s ease forwards;
    }
    
    /* Revert Centering */
    #sidebar.expanded .sidebar-profile-header {
        padding: 12px; justify-content: flex-start;
        background: var(--color-surface-hover); border: 1px solid var(--color-border);
    }
    #sidebar.expanded .sidebar-divider { margin: 0 10px 20px 10px; }
    #sidebar.expanded .sidebar-link { justify-content: flex-start; padding: 12px 16px; }
    #sidebar.expanded .sidebar-footer { align-items: stretch; }
    #sidebar.expanded .sidebar-link .text { display: inline-block; }
}

@keyframes fadeInText {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}

/* --- Top Bar (Neural Link) --- */
.neural-link-bar {
    position: fixed; top: 0; left: 0; right: 0; height: 30px;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(10px);
    z-index: 10001;
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 20px;
    border-bottom: 1px solid var(--glass-border);
    font-family: var(--font-family-mono);
    font-size: 10px; font-weight: 800; letter-spacing: 2px;
    color: var(--color-text-secondary);
}

.link-indicator { display: flex; align-items: center; gap: 8px; }
.link-dot { width: 8px; height: 8px; border-radius: 50%; background: #666; transition: all 0.5s ease; }
.link-dot.status-online { background: #10b981; box-shadow: 0 0 10px #10b981; }
.link-dot.status-buffering { background: #f59e0b; animation: pulse-amber 1s infinite; }
.link-dot.status-interrupted { background: #ef4444; box-shadow: 0 0 10px #ef4444; }

@keyframes pulse-amber {
    0% { opacity: 0.4; } 50% { opacity: 1; box-shadow: 0 0 10px #f59e0b; } 100% { opacity: 0.4; }
}

.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }

.card {
    background: var(--glass-surface);
    backdrop-filter: blur(25px) saturate(180%);
    -webkit-backdrop-filter: blur(25px) saturate(180%);
    border: 1px solid var(--glass-border);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
    border-radius: 24px;
}

@keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.spinner {
    width: 24px; height: 24px;
    border: 3px solid rgba(var(--color-primary-rgb), 0.2);
    border-top-color: var(--color-primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
