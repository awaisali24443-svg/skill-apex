


<div class="game-level-container">
    <div class="sr-only" id="announcer-region" role="alert" aria-live="assertive"></div>
    <div class="sr-only" id="timer-announcer-region" role="status" aria-live="polite"></div>
    
    <!-- State 1: Loading (Skeleton) -->
    <div id="level-loading-state" class="game-level-state active">
        <div class="state-content card">
             <div class="skeleton-header">
                <div class="skeleton" style="width: 60%; height: 32px; margin-bottom: 20px;"></div>
             </div>
             <div class="skeleton-body">
                <div class="skeleton" style="width: 100%; height: 16px; margin-bottom: 10px;"></div>
                <div class="skeleton" style="width: 90%; height: 16px; margin-bottom: 10px;"></div>
                <div class="skeleton" style="width: 95%; height: 16px; margin-bottom: 10px;"></div>
                <div class="skeleton" style="width: 80%; height: 16px; margin-bottom: 20px;"></div>
                <div class="skeleton" style="width: 40%; height: 40px;"></div>
             </div>
             <div id="loading-text-container" style="margin-top: 20px;">
                 <p>The AI is crafting your next challenge...</p>
                 <button id="cancel-generation-btn" class="btn">Cancel</button>
             </div>
        </div>
    </div>

    <!-- State 2: Lesson -->
    <div id="level-lesson-state" class="game-level-state">
        <div class="state-content card">
            <header class="lesson-header">
                <!-- PHASE 6: Dynamic AI Image Container -->
                <div id="lesson-image-container" class="lesson-image-container" style="display: none;">
                    <img id="lesson-image" src="" alt="Lesson Topic Illustration" style="width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.5s;">
                    <div class="image-overlay"></div>
                </div>
                <h1 id="lesson-title"></h1>
            </header>
            <main id="lesson-body" class="lesson-body"></main>
            
            <div id="ask-ai-container" class="ask-ai-container" style="display:none;">
                <div class="ask-ai-content">
                    <h3>AI Deep Dive</h3>
                    <p id="ask-ai-answer"></p>
                    <button id="close-ask-ai-btn" class="btn">Close</button>
                </div>
            </div>

            <footer class="lesson-footer">
                <button id="ask-ai-btn" class="btn" title="Select text to ask about it">
                    <svg class="icon"><use href="/assets/icons/feather-sprite.svg#search"/></svg>
                    <span>Deep Dive</span>
                </button>
                <button id="read-aloud-btn" class="btn">
                    <svg class="icon"><use href="/assets/icons/feather-sprite.svg#volume-2"/></svg>
                    <span>Read Aloud</span>
                </button>
                <button id="start-quiz-btn" class="btn btn-primary">
                    <span>Let's Go!</span>
                    <svg class="icon"><use href="/assets/icons/feather-sprite.svg#arrow-right"/></svg>
                </button>
            </footer>
        </div>
    </div>

    <!-- State 3: Quiz -->
    <div id="level-quiz-state" class="game-level-state">
        <header class="new-quiz-header">
            <a href="/#/" class="sidebar-logo" aria-label="Knowledge Tester Home">
                <img src="assets/icons/favicon.svg" alt="Knowledge Tester Logo" class="sidebar-logo-img">
                <span class="sidebar-logo-text">AI Quiz Nexus</span>
            </a>
            <!-- Boss Health Bar (Hidden by default) -->
            <div id="boss-health-container" class="boss-health-container" style="display: none;">
                <span class="boss-label">BOSS HP</span>
                <div class="boss-health-bar">
                    <div id="boss-health-fill" class="boss-health-fill" style="width: 100%;"></div>
                </div>
            </div>
            <!-- PHASE 3: Combo Meter -->
            <div id="combo-display" class="combo-display" style="opacity: 0;">
                <span class="combo-multiplier">x2</span>
                <span class="combo-label">Streak!</span>
            </div>
            <div class="quiz-header-actions">
                <button id="quit-btn" class="btn btn-danger">Quit</button>
            </div>
        </header>
        <div class="new-quiz-content">
            <div class="quiz-status-card">
                <div class="timer-section">
                    <p>Time</p>
                    <span id="timer-text">01:00</span>
                </div>
                <!-- CIRCULAR PROGRESS BAR (Phase 3 Requirement) -->
                <div class="question-progress-section circular">
                    <div class="progress-circle-container">
                       <svg viewBox="0 0 36 36" class="circular-chart">
                          <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                          <path id="quiz-progress-circle" class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                       </svg>
                       <span id="quiz-progress-text" class="percentage">1/5</span>
                    </div>
                    <p style="margin-top: 5px; font-size: 0.8rem;">Progress</p>
                </div>
            </div>
            <div id="question-container" class="card main-question-card">
                <h2 id="quiz-question-text">Loading question...</h2>
                <div id="quiz-options-container" class="options-grid">
                    <!-- Options will be injected here -->
                </div>
                <!-- PHASE 3: Instant Feedback Container -->
                <div id="feedback-container" class="feedback-container" style="display: none;">
                    <div class="feedback-icon"></div>
                    <div class="feedback-text">
                        <h3 id="feedback-title">Correct!</h3>
                        <p id="feedback-explanation">Explanation goes here.</p>
                    </div>
                </div>
            </div>
        </div>
        <footer class="new-quiz-footer">
             <button id="home-btn" class="btn">
                <svg class="icon"><use href="/assets/icons/feather-sprite.svg#home"/></svg>
                <span>Home</span>
            </button>
             <button id="hint-btn" class="btn">
                <svg class="icon"><use href="/assets/icons/feather-sprite.svg#lightbulb"/></svg>
                <span>Hint</span>
            </button>
            <div class="footer-spacer"></div>
            <button id="submit-answer-btn" class="btn btn-primary" disabled>Submit Answer</button>
        </footer>
    </div>
    
    <!-- State 4: Results -->
    <div id="level-results-state" class="game-level-state">
        <div id="share-capture-area" class="state-content card results-content">
            <div id="results-icon" class="results-icon"></div>
            <h1 id="results-title"></h1>
            <p id="xp-gain-text" class="xp-gain"></p>
            <p id="results-details"></p>
            
            <div id="results-actions" class="results-actions">
                <!-- Buttons injected by JS -->
            </div>
        </div>
        <!-- Separate share button outside capture area to avoid recursion -->
        <div class="share-container" style="margin-top: 20px;">
            <button id="share-result-btn" class="btn" style="background: var(--color-surface-active); border-color: var(--color-accent); color: var(--color-accent);">
                <svg class="icon"><use href="/assets/icons/feather-sprite.svg#award"/></svg>
                <span>Share Victory</span>
            </button>
        </div>
    </div>

</div>